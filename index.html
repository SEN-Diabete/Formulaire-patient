<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Formulaire Patient - Suivi Diabète</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f4f7fb; }
    form, #confirmation { background: #fff; padding: 20px; border-radius: 10px; max-width: 500px; margin: auto; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, textarea, select, button {
      width: 100%; padding: 10px; margin-top: 5px; border-radius: 5px; border: 1px solid #ccc;
    }
    button { background: #4CAF50; color: white; border: none; cursor: pointer; margin-top: 15px; }
    button:hover { background: #45a049; }
    #confirmation { display: none; text-align: center; font-size: 1.2em; color: #4CAF50; }
  </style>
</head>
<body>
  <h2>Formulaire Patient - Suivi Diabète</h2>

  <form id="patientForm" enctype="multipart/form-data">
    
    <label>Téléphone :</label>
    <input type="text" name="Téléphone" required placeholder="77xxxxxxx">

    <label>Date de la mesure :</label>
    <input type="date" name="Date_Mesure" required>

    <label>Heure de la mesure :</label>
    <input type="time" name="Heure_Mesure" required>

    <label>Type-Source :</label>
    <select name="type_source">
      <option value="Patient" selected>Patient</option>
      <option value="Médecin">Médecin</option>
      <option value="Pharmacie">Pharmacie</option>
    </select>

    <label>Glycémie (mg/dL) :</label>
    <input type="number" step="0.1" name="Glycemie" required>

    <label>À jeun ?</label>
    <select name="a_jeun">
      <option value="Oui">Oui</option>
      <option value="Non">Non</option>
    </select>

    <label>Tension artérielle :</label>
    <input type="text" name="Tension_Artérielle" placeholder="ex: 12/8">

    <label>Poids (kg) :</label>
    <input type="number" step="0.1" name="Poids">

    <label>Observations / Commentaires :</label>
    <textarea name="observations" placeholder="Ex: après repas, fatigue, ..."></textarea>

    <label>Structure de destination :</label>
    <select name="Structure-de-destination">
      <option value="Pharmacie">Pharmacie</option>
      <option value="Médecin">Médecin</option>
    </select>

    <label>Photo (optionnelle) :</label>
    <input type="file" name="Photo" accept="image/*">

    <input type="hidden" name="Source" value="Formulaire-patient">

    <button type="submit">Envoyer</button>
  </form>

  <div id="confirmation">Données envoyées ✅</div>

  <script>
    document.getElementById("patientForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      const form = e.target;

      // remplissage automatique date et heure si vide
      const dateField = form.querySelector("[name='date_mesure']");
      if (!dateField.value) dateField.value = new Date().toISOString().slice(0,10);

      const timeField = form.querySelector("[name='heure_mesure']");
      if (!timeField.value) {
        const now = new Date();
        timeField.value = now.toTimeString().slice(0,5);
      }

      const data = new FormData(form);

      try {
        await fetch("https://hook.us2.make.com/bx311ogqeeuj772zyjsbln30s9qkmcse", {
          method: "POST",
          body: data
        });

        // masquer le formulaire et afficher confirmation
        form.style.display = "none";
        document.getElementById("confirmation").style.display = "block";

      } catch(err) {
        alert("Erreur d'envoi : " + err);
      }
    });
  </script>
</body>
</html>
